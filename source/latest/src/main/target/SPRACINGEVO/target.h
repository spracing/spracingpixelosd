/*
 * SP Racing EVO - by Dominic Clifton
 *
 * Author: Dominic Clifton - Sync generation, Sync Detection, Video Overlay and first-cut of working OSD system.
 */
#pragma once

#ifndef SPRACINGEVO_REV
#define SPRACINGEVO_REV 1 // REV A
#endif

#define SPRACING_PIXEL_OSD_LED_1_PIN               PA0
#define SPRACING_PIXEL_OSD_LED_1_Pin               GPIO_PIN_0
#define SPRACING_PIXEL_OSD_LED_1_GPIO_Port         GPIOA

#define SPRACING_PIXEL_OSD_BLACK_SINK_PIN               PB0
#define SPRACING_PIXEL_OSD_BLACK_SINK_Pin               GPIO_PIN_0
#define SPRACING_PIXEL_OSD_BLACK_SINK_GPIO_Port         GPIOB

#define SPRACING_PIXEL_OSD_WHITE_SOURCE_FIXED_PIN       PB1
#define SPRACING_PIXEL_OSD_WHITE_SOURCE_FIXED_Pin       GPIO_PIN_1
#define SPRACING_PIXEL_OSD_WHITE_SOURCE_FIXED_GPIO_Port GPIOB

#define SPRACING_PIXEL_OSD_WHITE_SOURCE_SELECT_PIN      PB7
#define SPRACING_PIXEL_OSD_WHITE_SOURCE_SELECT_Pin          GPIO_PIN_7
#define SPRACING_PIXEL_OSD_WHITE_SOURCE_SELECT_GPIO_Port    GPIOB

#define SPRACING_PIXEL_OSD_MASK_ENABLE_PIN              PB6
#define SPRACING_PIXEL_OSD_MASK_ENABLE_Pin              GPIO_PIN_6
#define SPRACING_PIXEL_OSD_MASK_ENABLE_GPIO_Port        GPIOB

#define SPRACING_PIXEL_OSD_SYNC_IN_PIN                  PA1 // COMP1_INP
#define SPRACING_PIXEL_OSD_SYNC_IN_Pin                  GPIO_PIN_1
#define SPRACING_PIXEL_OSD_SYNC_IN_GPIO_Port            GPIOA
#define SPRACING_PIXEL_OSD_SYNC_IN_COMP                 COMP1
#define SPRACING_PIXEL_OSD_SYNC_TIM1_ETR_REMAP          TIM_TIM1_ETR_COMP1
#define SPRACING_PIXEL_OSD_SYNC_IN_COMP_INPUT           COMP_INPUT_PLUS_IO3 // PA1 for COMP1

#define SPRACING_PIXEL_OSD_SYNC_OUT_PIN                 PA8  // TIM1_CH1
#define SPRACING_PIXEL_OSD_SYNC_OUT_Pin                 GPIO_PIN_8
#define SPRACING_PIXEL_OSD_SYNC_OUT_GPIO_Port           GPIOA
#define USE_TIM1_CH1_FOR_SYNC
#define SYNC_TIMER_CHANNEL TIM_CHANNEL_1

#define SPRACING_PIXEL_OSD_WHITE_SOURCE_DAC_PIN         PA4  // DAC1_OUT1
#define SPRACING_PIXEL_OSD_VIDEO_THRESHOLD_DEBUG_PIN    PA5  // DAC1_OUT2
#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_1_PIN            PA2  // TIM15_CH1/UART2_TX - For DMA updates
#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_2_PIN            PA3  // TIM15_CH2/UART2_RX - Spare
#define SPRACING_PIXEL_OSD_PIXEL_GATING_DEBUG_PIN       PA11 // TIM1_CH4/CAN1_RX/USB_DM // actual gating is on CH4
#define SPRACING_PIXEL_OSD_PIXEL_BLANKING_DEBUG_PIN     PA10 // TIM1_CH3/UART1_RX // actual blanking is on CH5

#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_1_Pin            GPIO_PIN_2
#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_1_GPIO_Port      GPIOA
#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_2_Pin            GPIO_PIN_3
#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_2_GPIO_Port      GPIOA

#define SPRACING_PIXEL_OSD_GATING_DEBUG_Pin             GPIO_PIN_11
#define SPRACING_PIXEL_OSD_GATING_DEBUG_GPIO_Port       GPIOA

#define SPRACING_PIXEL_OSD_BLANKING_DEBUG_Pin           GPIO_PIN_10
#define SPRACING_PIXEL_OSD_BLANKING_DEBUG_GPIO_Port     GPIOA

#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_1_GPIO_AF        GPIO_AF14_TIM15
#define SPRACING_PIXEL_OSD_PIXEL_DEBUG_2_GPIO_AF        GPIO_AF14_TIM15
#define SPRACING_PIXEL_OSD_GATING_DEBUG_GPIO_AF         GPIO_AF1_TIM1
#define SPRACING_PIXEL_OSD_BLANKING_DEBUG_GPIO_AF       GPIO_AF1_TIM1

#define USE_PIXEL_OUT_GPIOB
#ifdef USE_PIXEL_OUT_GPIOB
#define PIXEL_BLACK_BIT                 0 // PB0
#define PIXEL_WHITE_BIT                 1 // PB1
#define PIXEL_WHITE_SOURCE_SELECT_BIT   7 // PB7
#define PIXEL_MASK_ENABLE_BIT           6 // PB6
#define PIXEL_CONTROL_FIRST_BIT PIXEL_BLACK_BIT
#define PIXEL_ODR_OFFSET 0 // 0 = Px0-Px7, 8 = Px8-Px15
#endif

#define SPRACING_PIXEL_OSD_VIDEO_IN_ADC_PIN             PA7
#define SPRACING_PIXEL_OSD_VIDEO_IN_ADC_Pin             GPIO_PIN_7
#define SPRACING_PIXEL_OSD_VIDEO_IN_GPIO_Port           GPIOA

#define SPRACING_PIXEL_OSD_VIDEO_OUT_ADC_PIN            PA6
#define SPRACING_PIXEL_OSD_VIDEO_OUT_ADC_Pin            GPIO_PIN_6
#define SPRACING_PIXEL_OSD_VIDEO_OUT_GPIO_Port          GPIOA

